<?php
include 'koneksi.php';
include 'ceklogin.php';



if(isset($_GET['idp'])){
    $idp = $_GET['idp'];

    // Pastikan $idp adalah angka yang valid sebelum digunakan dalam kueri SQL
    if (!is_numeric($idp)) {
        die("ID pesanan tidak valid.");
    }

    $ambilnamapelanggan = mysqli_query($c, "SELECT * FROM penjualan p, pelanggan pl WHERE p.PelangganID=pl.PelangganID AND p.PenjualanID=$idp");

    if (!$ambilnamapelanggan) {
        die("Kueri gagal ambil nama: " . mysqli_error($c));
    }

    $np = mysqli_fetch_array($ambilnamapelanggan);
    $namapel = $np['NamaPelanggan'];
    $idpel = $np['PelangganID'];

} else {
    header('Location:index.php');
}


// validasi if di atas jika tidak ada url view.php?idp=1 
// intinya jika di urlnya tidak ada id pesanan maka akan kembali ke halaman index

?>


<html>
<head>
<title>Kasir Ukk Hasan</title>
<style>
 
#tabel
{
font-size:15px;
border-collapse:collapse;
}
#tabel  td
{
padding-left:5px;
border: 1px solid black;
}
</style>
</head>
<body style='font-family:tahoma; font-size:8pt;'>
<center><table style='width:350px; font-size:16pt; font-family:calibri; border-collapse: collapse;' border = '0'>
<td width='70%' align='CENTER' vertical-align:top'><span style='color:black;'>
<b>UKK KASIR 2024</b></br>SMK NU 01 KENDAL</span></br>
 
 
<span style='font-size:12pt'>No. : xxxxx, 11 Juni 2020 (user:HASAN), 11:57:50</span></br>
</td>
</table>
<style>
hr { 
    display: block;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    margin-left: auto;
    margin-right: auto;
    border-style: inset;
    border-width: 1px;
} 
</style>
<table cellspacing='0' cellpadding='0' style='width:450px; font-size:12pt; font-family:calibri;  border-collapse: collapse;' border='0'>
 
<tr align='center'>

<!-- <td width='10%'>Nama Pelanggan</td> -->
<td width='10%'>Item</td>
<td width='13%'>Price</td>
<td width='4%'>Qty</td>
<td width='7%'>Diskon %</td>
<td width='13%'>Total</td><tr>
<td colspan='5'><hr></td></tr>
</tr>

<?php
    $get = mysqli_query($c, "select * from detailpenjualan p, produk pr where p.ProdukID=pr.
    ProdukID and PenjualanID='$idp'");
    // ini join table query php menghubungkan table detailpenjualan + table produk
 

    while ($p = mysqli_fetch_array($get)) {
        $idpr = $p['ProdukID'];
        $iddp = $p['DetailID'];
        $idp = $p['PenjualanID'];
        $qty = $p['JumlahProduk'];
        $harga = $p['Harga'];
        $namaproduk = $p['NamaProduk'];
        $desk = $p['Deskripsi'];
        $subtotal = $p['Subtotal'];
        // $subtotal = $qty*$harga;
?>

  
    <td><?= $namaproduk; ?></td>
    <td>Rp<?=number_format($harga); ?></td>
    <td><?=number_format($qty); ?></td>
    <td>Rp<?=number_format($subtotal); ?></td>

<tr>
    <td style='vertical-align:top'> </td>
<td style='vertical-align:top text-align:right; padding-right:10px'><?= $namaproduk; ?></td>
<td style='vertical-align:top; text-align:right; padding-right:10px'><?=number_format($qty); ?></td>
<td style='vertical-align:top; text-align:right; padding-right:10px'>Rp<?=number_format($harga); ?></td>
<td style='vertical-align:top; text-align:right; padding-right:10px'><?=number_format($qty); ?></td>
<td style='text-align:right; vertical-align:top'>Rp<?=number_format($subtotal); ?></td></tr>

<?php
                                        }; //end of white

                                        ?>
<tr>
<td colspan='5'><hr></td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right'>Biaya Adm : </div></td><td style='text-align:right; font-size:16pt;'>Rp3.500,00</td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right; color:black'>Total : </div></td><td style='text-align:right; font-size:16pt; color:black'>747.500</td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right; color:black'>Cash : </div></td><td style='text-align:right; font-size:16pt; color:black'>1.000.000</td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right; color:black'>Change : </div></td><td style='text-align:right; font-size:16pt; color:black'>252.500</td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right; color:black'>DP : </div></td><td style='text-align:right; font-size:16pt; color:black'>0</td>
</tr>
<tr>
<td colspan = '4'><div style='text-align:right; color:black'>Sisa : </div></td><td style='text-align:right; font-size:16pt; color:black'>0</td>
</tr>
</table>
<table style='width:350; font-size:12pt;' cellspacing='2'><tr></br><td align='center'>****** TERIMAKASIH ******</br></td></tr></table></center></body>
</html>

<script>
 window.print();
 </script>